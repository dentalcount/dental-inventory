<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Dental Inventory</title>

<!-- Inline favicon -->
<link rel="icon"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3EðŸ¦·%3C/text%3E%3C/svg%3E">

<!-- Supabase UMD -->
<script src="https://unpkg.com/@supabase/supabase-js@2.44.4/dist/umd/supabase.js"></script>

<style>
  body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:#0b1220;color:#e5e7eb}
  .wrap{max-width:960px;margin:0 auto;padding:20px}
  .card{background:#0c1426;border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:16px;margin:14px 0}
  input,button{width:100%;padding:.7rem .8rem;border-radius:10px;border:1px solid rgba(255,255,255,.15);background:#0d1526;color:#e5e7eb}
  input:focus{outline:none;border-color:#22d3ee}
  button{cursor:pointer}
  .btn.primary{background:linear-gradient(90deg,#00c2ff,#14f1d9);color:#002b36;font-weight:700;border:none}
  .btn.alt{background:#1f2937;border:none}
  .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .hidden{display:none}
</style>
</head>
<body>
<div class="wrap">

  <h1>Dental Inventory</h1>

  <div id="authCard" class="card">
    <div class="row">
      <div>
        <label>Email (Magic Link)</label>
        <input id="email" type="email" placeholder="you@clinic.com"/>
      </div>
      <div style="align-self:end">
        <button id="btnMagic" class="btn primary">Send Link</button>
      </div>
    </div>
    <div class="row" style="margin-top:10px">
      <div><button id="btnGoogle" class="btn alt">Continue with Google</button></div>
      <div><button id="btnReset" class="btn alt">Reset Session</button></div>
    </div>
  </div>

  <div id="app" class="card hidden">
    <h2>Signed in âœ…</h2>
    <p>Youâ€™re authenticated. The full catalogue UI will render here.</p>
    <button id="btnSignOut" class="btn alt">Sign out</button>
  </div>

</div>

<script>
(function boot(){
  if(!window.supabase) return setTimeout(boot,10);

  // ---------- CONFIG ----------
  const REDIRECT_URL = 'https://dentalcount.github.io/dental-inventory/';
  const SUPABASE_URL  = 'https://sgjoadsefpcixvmthtfy.supabase.co';
  const SUPABASE_ANON_KEY =
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InNnam9hZHNlZnBjaXh2bXRodGZ5Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkwMDIyMjYsImV4cCI6MjA3NDU3ODIyNn0.UcmAuHzEtKZIBs0pGkcLyRIYcLzCA4tNfuuDkUVLpU8';

  const supa = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
    auth: { persistSession:true, detectSessionInUrl:true, flowType:'implicit' }
  });

  // ---------- DOM ----------
  const $ = id => document.getElementById(id);
  const authCard = $('authCard');
  const app = $('app');

  // ---------- AUTH ----------
  $('btnMagic').onclick = async () => {
    const email = $('email').value.trim();
    if(!email) return alert('Enter your email first.');
    const { error } = await supa.auth.signInWithOtp({
      email,
      options:{ emailRedirectTo: REDIRECT_URL }
    });
    if(error) return alert(error.message);
    alert('Check your email for the sign-in link.');
  };

  $('btnGoogle').onclick = async () => {
    const { error } = await supa.auth.signInWithOAuth({
      provider:'google',
      options:{ redirectTo: REDIRECT_URL, queryParams:{ prompt:'select_account' } }
    });
    if(error) alert(error.message);
  };

  $('btnReset').onclick = async () => {
    await supa.auth.signOut();
    localStorage.clear();sessionStorage.clear();
    location.replace(REDIRECT_URL);
  };

  $('btnSignOut').onclick = $('btnReset').onclick;

  // ---------- SESSION WATCH ----------
  async function checkSession(){
    const { data:{ session } } = await supa.auth.getSession();
    if(session?.user){
      authCard.classList.add('hidden');
      app.classList.remove('hidden');
    }else{
      authCard.classList.remove('hidden');
      app.classList.add('hidden');
    }
  }

  supa.auth.onAuthStateChange(checkSession);
  checkSession();  // initial run
})();
</script>
</body>
</html>
